# ---------------------------- General
# history
set -g history-limit 100000

# color
set -g default-terminal "screen-256color"

# Default shell to zsh
set-option -g default-shell /bin/zsh

# C-b is not acceptable -- Vim uses it, use C-q
#set-option -g prefix C-q
#bind-key C-q last-window

# Start numbering at 1 - nice cause it lines up with number keys
set -g base-index 1

# Allows for faster key repetition
set -s escape-time 0

# Rather than constraining window size to the maximum size of any client
# connected to the *session*, constrain window size to the maximum size of any
# client connected to *that window*. Much more reasonable.
setw -g aggressive-resize on

# Allows us to use <prefix> a <command> to send commands to a TMUX session inside
# another TMUX session
bind-key a send-prefix

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity on

# Highlight active window
#set-window-option -g window-status-current-bg red

# auto renumber windows when deleted
set-option -g renumber-windows on

# auto window rename
#set-window-option -g automatic-rename

# rm mouse mode fail
#set -g mode-mouse off
set-option -g mouse on

# --------------------------- Keybindings

# Vi copy mode
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi 'v' send -X begin-selection # Begin selection in copy mode.
bind-key -T copy-mode-vi 'C-v' send -X rectangle-toggle # Begin selection in copy mode.
bind-key -T copy-mode-vi 'y' send -X copy-selection # Yank selection in copy mode.
bind p paste-buffer

# hjkl pane traversal
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# c-hjkl resize
bind -r C-h resize-pane -L 3
bind -r C-k resize-pane -U 1
bind -r C-j resize-pane -D 1
bind -r C-l resize-pane -R 3
# and remap these to send via C-aC-hjkl
#bind-key C-h send-keys C-h
#bind-key C-j send-keys C-j
#bind-key C-k send-keys C-k
#bind-key C-l send-keys C-l

# reload config
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Move left and right - tabs
bind-key -n C-Left swap-window -t -1
bind-key -n C-Right swap-window -t +1

# clear the current pane
unbind C-k
bind -n C-k send-keys C-l \; clear-history

# screen splits
unbind '"' # h
unbind % # v
bind v split-window -h -c "#{pane_current_path}" # tmux is reversed
bind b split-window -v -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# synchronise panes - not sure this currently works, meant to copy this pane to all other panes in window?
bind y set-window-option synchronize-panes

# pane management
bind t break-pane # or <prefix> ! - moves pane to new window
bind g command-prompt -p "send pane to:" "join-pane -h -t '%%'"

# convenience for switching windows
bind C-n next-window
bind C-p previous-window

# ---------------------------- Plugins
#### Plugins
# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
# last saved environment is automatically restored when tmux is started.
# set -g @continuum-restore 'on'
# set -g @continuum-save-interval '10'

# for vim
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-capture-pane-contents 'on'
# Resurrect shortcuts:
#   prefix s - save
#   prefix r - restore
#   dtmux - delete tmux session (bash alias)

set -g @plugin 'seebi/tmux-colors-solarized'
set -g @colors-solarized 'light'

set -g @plugin 'tmux-plugins/tmux-prefix-highlight'

set -g @plugin 'jbnicolai/tmux-fpp'
# <prefix> f to open a window with path

set -g @plugin 'tmux-plugins/tmux-open'
# <prefix> o - open highlighted app
# <prefix> C-o - open in editor
# <prefix> S - google search

# net speed
set -g @plugin 'tmux-plugins/tmux-net-speed'

# Battery indicator
set -g @plugin 'tmux-plugins/tmux-battery'

# CPU tmux
set -g @plugin 'tmux-plugins/tmux-cpu'

set -g @plugin 'nhdaly/tmux-scroll-copy-mode'
# Enter copy mode when scrolling up

set -g @plugin 'tmux-plugins/tmux-yank'
# Copy to clipboard, not just local buffer

# initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'

# ------------------------ Layout

# https://stackoverflow.com/questions/25532773/change-background-color-of-active-or-inactive-pane-in-tmux/33553372#33553372
# http://www.deanbodenham.com/learn/tmux-pane-colours.html
# Colours go after so that they're not overridden
set-option -g pane-border-fg black
#set-option -g pane-active-border-fg blue
set-option -g pane-border-bg colour7
set-option -g pane-active-border-bg colour15
set -g window-style 'fg=default,bg=colour7'
set -g window-active-style 'fg=default,bg=colour15'

# ---------------------------- Status bar config
#set -g status-interval 1
set -g status-justify left # center align window list
set -g status-left-length 20
set -g status-right-length 140
set -g status-left '>'
set -g status-style fg=colour15,bg=default
set -g status-right '#[fg=white]< %a %H:%M %d %b'
set -g status-right "#{prefix_highlight} #[fg=white] %a %h-%d %H:%M"
# set -g status-right '%a %H:%M %d %b'
